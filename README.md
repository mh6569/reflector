# Reflector — Design Document

## Executive Summary
Reflector is a privacy-first, AI-powered journaling companion that helps users build consistent reflection habits while uncovering meaningful patterns in their emotional life. Designed to run entirely on-device, Reflector ensures complete privacy and true data ownership. The system guides users with contextual prompts, surfaces insights from their writing, and generates gentle summaries that help them understand themselves over time.

---

## 1. Problem Statement

### The Blank Page Problem
Journaling is widely recognized as beneficial for mental health, but most people struggle to sustain the habit:

| Challenge | Impact |
|----------|--------|
| Blank page anxiety | Users don’t know where to begin |
| Event logging vs. reflection | Entries lack emotional depth and intention |
| No pattern recognition | Users overlook trends or recurring themes in their own lives |
| Privacy concerns | Fear of intimate thoughts being exposed or stored externally |

---

## Our Solution
A supportive, intelligent journaling system that helps users reflect deeply while maintaining full control of their data.

### Core Capabilities
- **Prompts with context:** AI-generated questions informed by recent entries to help users start writing with purpose.  
- **Analyzes locally:** All sentiment, emotion, and theme detection happens on-device to protect user privacy.  
- **Visualizes patterns:** Mood trends, theme correlations, and emerging topics are displayed in minimal, user-friendly summaries.  
- **Insightful reflection summaries:** Weekly or monthly, Reflector highlights key themes, shifts, and moments of progress.  

Example:  
> “You wrote most often about feeling energized on days you took a morning walk. You also noted more creative ideas during those weeks.”

These summaries help users connect the dots in their own lives without manual effort.

### Commitment to Privacy
- Zero external data transmission  
- Fully encrypted storage  
- All analysis runs locally on-device  

---

---

## 2. System Overview

Reflector is designed as a lightweight, privacy-preserving journaling system that runs entirely on the user’s device.  
The architecture is intentionally simple, fast, and modular, with three core layers:

### **1. User Interface Layer (React)**
- Minimal, distraction-free writing interface  
- Daily contextual prompts  
- Views for past entries, mood trends, and summaries  
- Responsive design for desktop and mobile  

### **2. Local AI Layer (Transformers.js)**
Reflector uses small Hugging Face transformer models compiled for JavaScript, running fully in the browser through `@xenova/transformers`.

Local AI tasks include:
- Sentiment analysis for each entry  
- Embedding generation to capture semantic meaning  
- Lightweight clustering and keyword extraction  
- Generation of weekly or monthly insight summaries  

Models are downloaded once, cached locally, and reused without any network calls.

### **3. Local Data Layer (IndexedDB)**
- All entries, embeddings, and summaries are stored securely in IndexedDB  
- Storage is encrypted at rest  
- Auto-save ensures journaling feels effortless  
- Zero external transmission of text or metadata  

This three-layer structure ensures clear separation of concerns while maintaining complete privacy and offline functionality.

---

## 3. Technical Approach

### **On-Device NLP Pipeline**
Reflector integrates Hugging Face models through transformers.js to process journal text locally.  
The pipeline includes:

1. **Sentiment Model**  
   - Classifies each entry as positive, neutral, or negative  
   - Produces a confidence score for trend visualization  

2. **Embedding Model**  
   - Converts each entry into a numerical embedding vector  
   - Enables similarity detection, theme discovery, and clustering  

3. **Theme Extraction & Clustering**  
   - Computes cosine similarity between embeddings  
   - Groups semantically related entries  
   - Identifies frequently recurring concepts  

4. **Insight Generation**  
   Using analytic outputs, Reflector generates gentle summaries such as:  
   > “Your entries were more positive on days when you mentioned being outdoors.”  
   These summaries are produced using template-based natural language generation for reliability and tone control.

---

### **Contextual Prompt Engine**

Prompts are generated by evaluating:
- Recent themes  
- Mood patterns  
- Frequency of specific keywords  
- Gaps in journaling behavior  

Examples:
- If user hasn’t written in a few days:  
  *“What’s something small that stood out to you recently?”*  
- If recent entries mention stress:  
  *“What helped you navigate challenges today?”*  

The system remains lightweight while still feeling personalized.

---

### **Data Model Design**

```ts
export type JournalEntry = {
  id: string;
  createdAt: string;
  text: string;
  sentiment?: "positive" | "neutral" | "negative";
  sentimentScore?: number;
  embedding?: number[];
};

export type InsightSummary = {
  id: string;
  period: "weekly" | "monthly";
  insights: string[];
  averageSentiment: number;
  themeKeywords: string[];
  generatedAt: string;
};
